apiVersion: v1
kind: Pod
metadata:
  name: mc-smoke                # 临时测试 Pod
  namespace: cpemon
  labels: { app: db-backup }
spec:
  restartPolicy: Never          # 只跑一次
  containers:
  - name: mc
    image: minio/mc:latest
    # 覆盖默认 ENTRYPOINT（默认是 mc 命令），用 sh 执行多条命令
    command: ["sh","-lc"]
    args:
      - |
        mc alias set local "$ENDPOINT" "$ACCESS_KEY" "$SECRET_KEY" --api S3v4
        mc ls local
        mc ls "local/$BUCKET"
    env:                        # 从 Secret 注入环境变量
    - name: ENDPOINT
      valueFrom: { secretKeyRef: { name: minio-conn, key: endpoint } }
    - name: BUCKET
      valueFrom: { secretKeyRef: { name: minio-conn, key: bucket } }
    - name: ACCESS_KEY
      valueFrom: { secretKeyRef: { name: minio-conn, key: accessKey } }
    - name: SECRET_KEY
      valueFrom: { secretKeyRef: { name: minio-conn, key: secretKey } }

