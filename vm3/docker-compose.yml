version: "3.9"

services:
  mongo:
    image: mongo:7.0
    container_name: genieacs-mongo
    restart: unless-stopped
    command: ["mongod", "--bind_ip_all"]
    volumes:
      - mongo-data:/data/db
    networks:
      - genieacs-net

  genieacs:
    image: drumsergio/genieacs:1.2.13
    container_name: genieacs
    restart: unless-stopped
    depends_on:
      - mongo
    # è¿™é‡Œç”¨ host çš„ 3000 / 7547 / 7557 / 7567 ç›´æ¥æ˜ å°„å‡ºæ¥
    ports:
      - "3000:3000" # UI
      - "7547:7547" # CWMP (TR-069)
      - "7557:7557" # NBI REST API
      - "7567:7567" # File server
    environment:
      # æ—¶åŒºéšä¾¿å¡«ä¸€ä¸ªä½ ä¹ æƒ¯çš„ï¼Œä¸»è¦æ˜¯æ—¥å¿—æ—¶é—´å¥½çœ‹ä¸€ç‚¹
      - TZ=Europe/Copenhagen
      # ğŸ‘‡ å…³é”®ä¸€ï¼šè®© GenieACS è¿æ¥åˆ°â€œmongoâ€è¿™ä¸ªæœåŠ¡ï¼Œè€Œä¸æ˜¯é”™è¯¯çš„ 127.0.0.1
      - GENIEACS_MONGODB_CONNECTION_URL=mongodb://mongo:27017/genieacs
      # ğŸ‘‡ å…³é”®äºŒï¼šUI çš„ JWT Secretï¼ˆç­¾å cookie ç”¨ï¼‰ï¼Œéšä¾¿ç»™ä¸ªé•¿ä¸€ç‚¹çš„å­—ç¬¦ä¸²
      - GENIEACS_UI_JWT_SECRET=cpemon-mvp-super-secret-please-change
      - CPEMON_WEBHOOK_URL=http://api.local/acs/webhook
      - CPEMON_WEBHOOK_SECRET=cpemon-demo-secret
    volumes:
      # æŠŠ /opt æŒ‚å‡ºæ¥ï¼Œå†…éƒ¨ä¼šæ”¾ä¸€äº›é…ç½®ä¸æ—¥å¿—ï¼Œå°†æ¥è¦è°ƒä¼˜æ–¹ä¾¿ä¸€ç‚¹
      - genieacs-opt:/opt
      - ./ext:/opt/genieacs/ext
    networks:
      - genieacs-net
    extra_hosts:
      # å¦‚æœä½ å·²æœ‰ extra_hostsï¼Œå°±åœ¨é‡Œé¢è¿½åŠ è¿™ä¸€è¡Œ
      - "api.local:10.0.0.200"

volumes:
  mongo-data:
  genieacs-opt:

networks:
  genieacs-net:
    driver: bridge
